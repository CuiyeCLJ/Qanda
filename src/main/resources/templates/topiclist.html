<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>话题列表</title>
    <script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/layui/layui.all.js}"></script>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}">
    <link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <link rel="stylesheet" th:href="@{/css/topic.css}">

    <style>
        .layui-card {
            width: 612px;
            margin: auto;
            margin-top: 8px;
        }
    </style>

    <script>
        function follow(e, topicId, userId) {
            var followStatus = 0;
            var count = $(e).find('span').html();
            if ($(e).hasClass('qa-topic-followed')) {
                count = parseInt(count) - 1;
                $(e).find('span').html(count);
                $(e).removeClass('qa-topic-followed');
            } else {
                followStatus = 1;
                count = parseInt(count) + 1;
                $(e).find('span').html(count);
                $(e).addClass('qa-topic-followed')
            }
            $.ajax({
                url: "/topic/updateTopicAttention",
                type: "POST",
                data: {
                    topicId: topicId,
                    userId: userId,
                    followStatus: followStatus
                }
            })
        }

    </script>
</head>
<body>
<!-- 导航 -->
<div class="layui-header header header-index" id="qa-nav">
    <div class="layui-main">
        <a class="logo" href="/">
            <img th:src="@{/img/qanda.png}" alt="layui">
        </a>

        <ul class="layui-nav" id="qa-ul">
            <li class="layui-nav-item layui-this"><a href="index.html">Home</a></li>
            <li class="layui-nav-item"><a href="index.html">回答</a></li>
            <li class="layui-nav-item"><a href="index.html">通知</a></li>
        </ul>

        <div class="layui-inline qa-search">
            <input placeholder="搜索问题" name="keywords" autocomplete="off" value="" class="qa-search-input">
            <button class="layui-btn"><i class="layui-icon layui-icon-search"></i></button>
        </div>

        <div class="qa-name">
            <a th:text="${session.user.username != null}? ${session.user.username} : ''" href="#"></a>
        </div>

        <div class="qa-question-btn">
            <button onclick="question(this)">添加问题</button>
        </div>
    </div>
</div>

<div class="layui-card" th:each="topic : ${topics}">
    <div class="layui-card-body">
        <div class="qa-topic-img"></div>
        <h2 th:text="${topic.topicName}" class="qa-topic-title"></h2>
        <div class="qa-topic-follow" th:classappend="${topic.followStatus == 1}? 'qa-topic-followed'"
             th:onclick="|follow(this, '${topic.id}', '${session.user.id}')|">
            <i class="layui-icon layui-icon-praise"
               style="font-size: 25px; padding-left: 15px; padding-top: 10px;"></i>
            <b>Follow · </b>
            <span th:text="${topic.attention}"></span>
        </div>
    </div>
</div>

</body>
</html>